# song2html Format Specification

This document specifies the input format for chord charts and describes the HTML output generated by `song2html`.

---

## Input Format Overview

The input is a plain text file with a specific structure using **2-space indentation** for metadata/chords and **4-space indentation** for section content.

```
Title [Key]
  metadata...
  section-chords...

Sections:
  Section Name:
    lyric content with ^chord markers...

Arrangements:
  Arrangement Name:
    Section Name
    ...
```

---

## 1. Title Line

The first line is the song title, optionally with a key in brackets.

```
Song Title [C]
```

**Key format:** `[X]`, `[X#]`, `[Xb]`, `[Xm]`, `[X#m]`, `[Xbm]`
- Supports Unicode: `♯` → `#`, `♭` → `b`
- Examples: `[C]`, `[F#]`, `[Bb]`, `[Am]`, `[F#m]`

---

## 2. Metadata (2-space indentation)

Built-in metadata keys (all optional):

| Key | Description | Example |
|-----|-------------|---------|
| `author:` | Songwriter(s), comma-separated | `author: John Newton` |
| `key:` | Musical key | `key: G` |
| `tempo:` | BPM (number) | `tempo: 120` |
| `time:` | Time signature | `time: 4/4` |

```
Amazing Grace [G]
  author: John Newton
  key: G
  tempo: 72
  time: 3/4
```

---

## 3. Chord Definitions (2-space indentation)

Any key that isn't `author`, `key`, `tempo`, or `time` defines chord progressions for sections.

```
  verse: G C D G
  chorus: C D Em G
  bridge: Am D G
```

**Section matching:** Lyrics sections are matched to chord definitions by their first word (case-insensitive).
- `Verse 1:` → uses `verse:` chords
- `Verse 2:` → uses `verse:` chords
- `Chorus:` → uses `chorus:` chords

### Chord Notation Types

#### Standard Chords
```
C  Dm  Em7  Fmaj7  G7  Am  Bdim
```

#### Slash Chords (bass note)
```
C/G  Am/E  F/C  G/D
```

#### Treble Chords (melody note)
```
F\A  G\B
```

#### Nashville Number System
Uses scale degrees (1-7) instead of chord names. Automatically transposed based on the song's key.

| Number | Scale Degree | Quality |
|--------|-------------|---------|
| 1 | Tonic | Major |
| 2 | Supertonic | minor |
| 3 | Mediant | minor |
| 4 | Subdominant | Major |
| 5 | Dominant | Major |
| 6 | Submediant | minor |
| 7 | Leading tone | diminished |

**Example in key of G:**
```
  verse: 1 4 5 1    →  G C D G
  chorus: 4 5 6 1   →  C D Em G
```

**Nashville Slash Chords:**
```
  verse: 1/5 4/1    →  G/D C/G
```

#### Chord Repetition
```
  verse: (G C) x2 D G    →  G C G C D G
  chorus: (E A)x3        →  E A E A E A
```

#### Chord Melody
Attach melody notes to chords with a hyphen:
```
  verse: G-BCD Am-EFG      (named notes)
  verse: 1-123 4-456       (Nashville - transposed)
```

---

## 4. Sections (4-space indentation)

The `Sections:` header (case-insensitive) begins the lyrics portion.

```
Sections:
  Verse 1:
    ^Amazing ^grace, how ^sweet the ^sound
    ^That saved a ^wretch like ^me

  Chorus:
    ^I once was ^lost, but ^now I'm ^found
```

### Chord Markers (`^`)

The caret `^` marks where chords appear in lyrics:
- Each `^` inserts the next chord from the section's chord progression
- If more carets than chords, the progression cycles from the beginning

```
  verse: G C D G

Sections:
  Verse 1:
    ^Amazing ^grace, how ^sweet the ^sound
     ↑G       ↑C          ↑D         ↑G
```

---

## 5. Arrangements (Optional)

Define custom section orders under `Arrangements:`:

```
Arrangements:
  Short:
    Verse 1
    Chorus

  Full:
    Verse 1
    Chorus
    Verse 2
    Chorus
    Bridge
    Chorus
```

If no arrangements are defined, sections render in the order they appear.

---

## Complete Input Example

```
Amazing Grace [G]
  author: John Newton
  tempo: 72
  time: 3/4

  verse: G C G D
  chorus: C G D G

Sections:
  Verse 1:
    ^Amazing ^grace, how ^sweet the ^sound
    ^That saved a ^wretch like ^me

  Verse 2:
    ^I once was ^lost, but ^now am ^found
    ^Was blind, but ^now I ^see

  Chorus:
    ^Through many ^dangers, ^toils and ^snares

Arrangements:
  Short:
    Verse 1
    Chorus

  Full:
    Verse 1
    Chorus
    Verse 2
    Chorus
```

---

## HTML Output Structure

### Top-Level Container
```html
<article class="s2h-song">
  <!-- paginated content -->
</article>
```

### Pages
Content is paginated into `<section class="s2h-page">` elements:
```html
<section class="s2h-page" data-page="1">
  <!-- metadata, chords, and first sections -->
</section>
<section class="s2h-page" data-page="2">
  <!-- additional sections -->
</section>
```

### Metadata Section
```html
<section class="s2h-meta">
  <h2 class="s2h-meta-title">Amazing Grace</h2>
  <p class="s2h-meta-key"><strong>Key:</strong> G</p>
  <p class="s2h-meta-tempo"><strong>Tempo:</strong> 72</p>
  <p class="s2h-meta-time"><strong>Time:</strong> 3/4</p>
  <p class="s2h-meta-authors"><strong>Author:</strong> John Newton</p>
</section>
```

### Chords Summary
```html
<section class="s2h-chords">
  <h3 class="s2h-chords-title">Chords</h3>
  <p class="s2h-chord-line">
    <span class="s2h-chord-section-label">Verse</span>
    <span class="s2h-chord">G</span>
    <span class="s2h-chord">C</span>
    <span class="s2h-chord">G</span>
    <span class="s2h-chord">D</span>
  </p>
</section>
```

### Lyric Sections
```html
<section id="verse-1" class="s2h-section s2h-section-verse-1">
  <h3 class="s2h-section-title">Verse 1</h3>
  <p class="s2h-lyric-line">
    <sup class="s2h-chord">G</sup>Amazing
    <sup class="s2h-chord">C</sup>grace, how
    <sup class="s2h-chord">G</sup>sweet the
    <sup class="s2h-chord">D</sup>sound
  </p>
  <p class="s2h-lyric-line">
    <sup class="s2h-chord">G</sup>That saved a
    <sup class="s2h-chord">C</sup>wretch like
    <sup class="s2h-chord">G</sup>me
  </p>
</section>
```

### Section IDs
- Generated from section name (lowercase, hyphenated)
- Duplicate sections get numbered suffixes: `verse-1`, `verse-1-2`, `verse-1-3`

---

## Complete Output Example

**Input:**
```
Amazing Grace [G]
  author: John Newton
  tempo: 72
  time: 3/4

  verse: G C G D
  chorus: C G D G

Sections:
  Verse 1:
    ^Amazing ^grace, how ^sweet the ^sound
    ^That saved a ^wretch like ^me

  Chorus:
    ^I once was ^lost, but ^now I'm ^found

Arrangements:
  Short:
    Verse 1
    Chorus
```

**Output:**
```html
<article class="s2h-song">
<section class="s2h-page" data-page="1">
<section class="s2h-meta">
<h2 class="s2h-meta-title">Amazing Grace</h2>
<p class="s2h-meta-key"><strong>Key:</strong> G</p>
<p class="s2h-meta-tempo"><strong>Tempo:</strong> 72</p>
<p class="s2h-meta-time"><strong>Time:</strong> 3/4</p>
<p class="s2h-meta-authors"><strong>Author:</strong> John Newton</p>
</section>
<section class="s2h-chords"><h3 class="s2h-chords-title">Chords</h3>
<p class="s2h-chord-line"><span class="s2h-chord-section-label">Verse 1</span> <span class="s2h-chord">G</span> <span class="s2h-chord">C</span> <span class="s2h-chord">G</span> <span class="s2h-chord">D</span></p>
<p class="s2h-chord-line"><span class="s2h-chord-section-label">Chorus</span> <span class="s2h-chord">C</span> <span class="s2h-chord">G</span> <span class="s2h-chord">D</span> <span class="s2h-chord">G</span></p>
</section>
<section id="verse-1" class="s2h-section s2h-section-verse-1">
<h3 class="s2h-section-title">Verse 1</h3>
<p class="s2h-lyric-line"><sup class="s2h-chord">G</sup>Amazing <sup class="s2h-chord">C</sup>grace, how <sup class="s2h-chord">G</sup>sweet the <sup class="s2h-chord">D</sup>sound</p>
<p class="s2h-lyric-line"><sup class="s2h-chord">G</sup>That saved a <sup class="s2h-chord">C</sup>wretch like <sup class="s2h-chord">G</sup>me</p>
</section>
<section id="chorus" class="s2h-section s2h-section-chorus">
<h3 class="s2h-section-title">Chorus</h3>
<p class="s2h-lyric-line"><sup class="s2h-chord">C</sup>I once was <sup class="s2h-chord">G</sup>lost, but <sup class="s2h-chord">D</sup>now I&#039;m <sup class="s2h-chord">G</sup>found</p>
</section>
</section>
</article>
```

---

## CSS Classes Reference

| Class | Element | Description |
|-------|---------|-------------|
| `s2h-song` | `<article>` | Root container |
| `s2h-page` | `<section>` | Page container (has `data-page` attribute) |
| `s2h-meta` | `<section>` | Metadata container |
| `s2h-meta-title` | `<h2>` | Song title |
| `s2h-meta-key` | `<p>` | Key display |
| `s2h-meta-tempo` | `<p>` | Tempo display |
| `s2h-meta-time` | `<p>` | Time signature display |
| `s2h-meta-authors` | `<p>` | Author(s) display |
| `s2h-chords` | `<section>` | Chord summary container |
| `s2h-chords-title` | `<h3>` | "Chords" heading |
| `s2h-chord-line` | `<p>` | Chord progression line |
| `s2h-chord-section-label` | `<span>` | Section name in chord summary |
| `s2h-chord` | `<span>` or `<sup>` | Individual chord |
| `s2h-section` | `<section>` | Lyric section container |
| `s2h-section-{name}` | `<section>` | Section-specific class |
| `s2h-section-title` | `<h3>` | Section heading |
| `s2h-lyric-line` | `<p>` | Line of lyrics |

---

## JavaScript API

```javascript
import songToHtml from 'song2html';

const result = songToHtml(sourceText, arrangementName);
```

**Parameters:**
- `sourceText` (string): The chord chart in the format above
- `arrangementName` (string, optional): Which arrangement to use

**Returns:**
```javascript
{
  html: string,           // Complete HTML markup
  arrangements: string[], // Available arrangement names
  song: {
    title: string,        // Song title
    key: string|null,     // Musical key (e.g., "G", "F#m")
    tempo: number|null,   // BPM
    time: string|null,    // Time signature
    authors: string[]     // Array of author names
  }
}
```

---

## Quick Reference: Converting a Chord Chart

To convert a typical chord chart to this format:

1. **Title line:** Put title, add key in brackets: `Song Name [G]`
2. **Metadata:** Indent 2 spaces, add `author:`, `tempo:`, `time:` as needed
3. **Chord definitions:** Indent 2 spaces, name sections and list chords: `verse: G C D G`
4. **Sections:** Add `Sections:` header, then 2-space indented section names with colons
5. **Lyrics:** Indent 4 spaces, place `^` before each syllable where a chord change occurs
6. **Arrangements (optional):** Add `Arrangements:` header with named section orders
